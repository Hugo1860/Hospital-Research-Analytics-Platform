# 需求文档

## 介绍

协和医院SCI期刊分析系统的批量导入功能需要修复模板下载功能，并退出演示模式使用真实API。当前系统在文献批量导入和期刊批量导入页面中，用户点击下载模板按钮时无法正常下载Excel模板文件。同时系统可能运行在演示模式下，需要切换到真实API模式以确保所有功能正常工作。

## 需求

### 需求 1 - 文献批量导入模板下载修复

**用户故事：** 作为用户，我希望在文献批量导入页面能够下载Excel导入模板，以便了解正确的数据格式并准备导入文件。

#### 验收标准

1. 当用户点击文献导入页面的"下载模板"按钮时，系统应当下载包含正确字段的Excel模板文件
2. 模板文件应当包含必要的列标题：标题、作者、期刊名称、发表年份、卷号、期号、页码、DOI、PMID等
3. 模板文件应当包含示例数据行，帮助用户理解数据格式
4. 下载的文件名应当包含时间戳，格式为"文献导入模板_YYYYMMDD.xlsx"
5. 当模板下载失败时，系统应当显示明确的错误提示信息

### 需求 2 - 期刊批量导入模板下载修复

**用户故事：** 作为管理员，我希望在期刊批量导入页面能够下载Excel导入模板，以便准备期刊数据的批量导入。

#### 验收标准

1. 当管理员点击期刊导入页面的"下载模板"按钮时，系统应当下载包含正确字段的Excel模板文件
2. 模板文件应当包含必要的列标题：期刊名称、ISSN、影响因子、分区、学科分类、出版商、年份等
3. 模板文件应当包含示例数据行，展示正确的数据格式和分区值（Q1、Q2、Q3、Q4）
4. 下载的文件名应当包含时间戳，格式为"期刊导入模板_YYYYMMDD.xlsx"
5. 当模板下载失败时，系统应当显示明确的错误提示信息

### 需求 3 - 退出演示模式配置

**用户故事：** 作为系统管理员，我希望系统能够退出演示模式并使用真实API，以便所有功能都能正常工作。

#### 验收标准

1. 系统应当检查当前是否运行在演示模式下
2. 当系统运行在演示模式时，应当提供切换到真实API模式的配置选项
3. 切换到真实API模式后，所有API请求应当发送到实际的后端服务器
4. 系统应当验证真实API的连接状态和可用性
5. 当API连接异常时，系统应当显示相应的错误信息和故障排除建议

### 需求 4 - 模板文件生成API

**用户故事：** 作为后端服务，我希望能够动态生成Excel模板文件，以便为前端提供最新的导入模板。

#### 验收标准

1. 后端应当提供文献导入模板生成API接口 `/api/templates/publications`
2. 后端应当提供期刊导入模板生成API接口 `/api/templates/journals`
3. API应当返回正确的Excel文件内容和Content-Type头
4. 生成的模板文件应当包含正确的列标题和示例数据
5. API应当支持认证验证，确保只有授权用户可以下载模板

### 需求 5 - 前端模板下载功能实现

**用户故事：** 作为前端应用，我希望能够正确处理模板下载请求，以便用户能够顺利下载模板文件。

#### 验收标准

1. 前端应当正确调用后端模板生成API
2. 前端应当处理二进制文件下载，设置正确的响应类型
3. 前端应当使用浏览器的下载功能触发文件保存
4. 前端应当在下载过程中显示加载状态指示器
5. 前端应当处理下载失败的错误情况并显示用户友好的错误信息

### 需求 6 - 模板内容标准化

**用户故事：** 作为用户，我希望下载的模板文件内容标准化且易于理解，以便能够正确准备导入数据。

#### 验收标准

1. 文献模板应当包含中英文对照的列标题
2. 期刊模板应当包含影响因子的数值格式说明
3. 模板应当包含数据验证规则的说明（如必填字段、格式要求）
4. 模板应当包含常见错误和注意事项的说明
5. 模板文件应当使用统一的样式格式，提高可读性

### 需求 7 - 错误处理和用户反馈

**用户故事：** 作为用户，我希望在模板下载过程中遇到问题时，能够获得清晰的错误信息和解决建议。

#### 验收标准

1. 当网络连接失败时，系统应当显示网络错误提示
2. 当服务器无法生成模板时，系统应当显示服务器错误提示
3. 当用户权限不足时，系统应当显示权限错误提示
4. 当浏览器不支持文件下载时，系统应当提供替代方案
5. 所有错误提示应当包含具体的解决建议和联系方式