# 生产部署检查清单

## 概述

本检查清单确保协和医院SCI期刊分析系统在生产环境中的安全、稳定部署。请在部署前逐项检查并确认。

## 📋 部署前检查

### 🔧 系统环境

- [ ] **操作系统**: Ubuntu 20.04 LTS / CentOS 8 / RHEL 8
- [ ] **Node.js**: v18.x LTS 已安装
- [ ] **MySQL**: v8.0+ 已安装并配置
- [ ] **Nginx**: v1.18+ 已安装
- [ ] **PM2**: v5.x 已全局安装
- [ ] **Git**: 最新版本已安装
- [ ] **系统时间**: 已同步（使用NTP）

### 🗄️ 数据库配置

- [ ] **数据库创建**: `hospital_journal_prod` 数据库已创建
- [ ] **用户权限**: 专用数据库用户已创建并授权
- [ ] **字符集**: UTF8MB4 字符集配置正确
- [ ] **索引优化**: 关键表索引已创建
- [ ] **备份策略**: 自动备份脚本已配置
- [ ] **连接池**: 连接池参数已优化
- [ ] **慢查询日志**: 已启用慢查询监控

### 🔐 安全配置

- [ ] **SSL证书**: HTTPS证书已安装并配置
- [ ] **防火墙**: 防火墙规则已配置
- [ ] **SSH密钥**: 密钥认证已启用，密码认证已禁用
- [ ] **用户权限**: 非root用户部署，最小权限原则
- [ ] **敏感文件**: .env文件权限设置为600
- [ ] **JWT密钥**: 强随机JWT密钥已生成
- [ ] **数据库密码**: 强密码已设置
- [ ] **CORS配置**: 正确的跨域配置

### 📁 文件和目录

- [ ] **应用目录**: `/var/www/journal` 目录已创建
- [ ] **日志目录**: `/var/log/journal` 目录已创建
- [ ] **备份目录**: `/var/backups/journal` 目录已创建
- [ ] **上传目录**: `/var/uploads/journal` 目录已创建
- [ ] **目录权限**: 所有目录权限正确设置
- [ ] **磁盘空间**: 足够的磁盘空间（至少50GB可用）

### 🌐 网络配置

- [ ] **域名解析**: DNS记录已正确配置
- [ ] **端口开放**: 必要端口（80, 443, 22）已开放
- [ ] **负载均衡**: 负载均衡器已配置（如适用）
- [ ] **CDN配置**: CDN已配置（如适用）
- [ ] **网络监控**: 网络监控已启用

## 📦 应用部署

### 🔄 代码部署

- [ ] **代码拉取**: 最新生产代码已拉取
- [ ] **依赖安装**: 生产依赖已安装（`npm ci --production`）
- [ ] **环境变量**: `.env.production` 文件已正确配置
- [ ] **数据库迁移**: 数据库迁移已执行
- [ ] **种子数据**: 初始数据已导入（如需要）
- [ ] **静态资源**: 前端资源已构建并部署

### ⚙️ 服务配置

- [ ] **PM2配置**: `ecosystem.config.js` 已配置
- [ ] **Nginx配置**: 虚拟主机配置已部署
- [ ] **系统服务**: 相关系统服务已启用自启动
- [ ] **日志轮转**: 日志轮转已配置
- [ ] **监控代理**: 监控代理已安装并配置

### 🔍 配置验证

- [ ] **环境变量**: 所有必需的环境变量已设置
- [ ] **数据库连接**: 数据库连接测试通过
- [ ] **Redis连接**: Redis连接测试通过（如使用）
- [ ] **邮件配置**: SMTP配置测试通过
- [ ] **文件权限**: 应用文件权限正确
- [ ] **配置语法**: Nginx配置语法检查通过

## 🚀 服务启动

### 📊 服务状态

- [ ] **MySQL服务**: 已启动并运行正常
- [ ] **Redis服务**: 已启动并运行正常（如使用）
- [ ] **Nginx服务**: 已启动并运行正常
- [ ] **PM2进程**: 应用进程已启动
- [ ] **系统监控**: 监控服务已启动

### 🔍 健康检查

- [ ] **API健康检查**: `GET /api/health` 返回正常
- [ ] **数据库连接**: 数据库连接池正常
- [ ] **前端访问**: 前端页面可正常访问
- [ ] **HTTPS访问**: HTTPS重定向正常工作
- [ ] **API认证**: 认证接口正常工作

## 🧪 功能测试

### 🔐 认证功能

- [ ] **用户登录**: 管理员账户可正常登录
- [ ] **Token验证**: Token验证机制正常
- [ ] **权限控制**: 角色权限控制正常
- [ ] **跨标签页同步**: 多标签页状态同步正常
- [ ] **自动登出**: Token过期自动登出正常

### 📊 核心功能

- [ ] **文献管理**: 文献CRUD操作正常
- [ ] **期刊管理**: 期刊CRUD操作正常
- [ ] **数据导入**: Excel文件导入功能正常
- [ ] **统计分析**: 统计图表显示正常
- [ ] **报告生成**: PDF/Excel报告生成正常

### 📁 文件操作

- [ ] **文件上传**: 文件上传功能正常
- [ ] **文件下载**: 文件下载功能正常
- [ ] **模板下载**: 导入模板下载正常
- [ ] **报告导出**: 报告导出功能正常

## 🔍 性能测试

### ⚡ 响应时间

- [ ] **API响应**: 平均响应时间 < 200ms
- [ ] **页面加载**: 首页加载时间 < 3秒
- [ ] **数据库查询**: 复杂查询时间 < 1秒
- [ ] **文件上传**: 10MB文件上传 < 30秒

### 🏋️ 负载测试

- [ ] **并发用户**: 支持50个并发用户
- [ ] **API并发**: 支持100个并发API请求
- [ ] **数据库连接**: 连接池配置合理
- [ ] **内存使用**: 内存使用率 < 80%
- [ ] **CPU使用**: CPU使用率 < 70%

## 🛡️ 安全测试

### 🔒 认证安全

- [ ] **密码策略**: 强密码策略已启用
- [ ] **会话管理**: 会话超时配置正确
- [ ] **权限验证**: API权限验证正常
- [ ] **SQL注入**: SQL注入防护测试通过
- [ ] **XSS防护**: XSS攻击防护测试通过

### 🌐 网络安全

- [ ] **HTTPS强制**: HTTP自动重定向到HTTPS
- [ ] **安全头**: 安全HTTP头已配置
- [ ] **CORS配置**: 跨域配置安全合理
- [ ] **端口扫描**: 不必要端口已关闭
- [ ] **漏洞扫描**: 安全漏洞扫描通过

## 📊 监控配置

### 📈 系统监控

- [ ] **CPU监控**: CPU使用率监控已配置
- [ ] **内存监控**: 内存使用监控已配置
- [ ] **磁盘监控**: 磁盘空间监控已配置
- [ ] **网络监控**: 网络流量监控已配置
- [ ] **进程监控**: 应用进程监控已配置

### 📊 应用监控

- [ ] **API监控**: API响应时间监控
- [ ] **错误监控**: 应用错误监控
- [ ] **用户监控**: 用户活动监控
- [ ] **性能监控**: 应用性能监控
- [ ] **日志监控**: 日志异常监控

### 🚨 告警配置

- [ ] **邮件告警**: 邮件告警已配置
- [ ] **短信告警**: 短信告警已配置（如需要）
- [ ] **告警规则**: 告警规则已设置
- [ ] **告警测试**: 告警功能测试通过
- [ ] **值班安排**: 值班人员联系方式已更新

## 💾 备份配置

### 🗄️ 数据备份

- [ ] **数据库备份**: 自动数据库备份已配置
- [ ] **文件备份**: 应用文件备份已配置
- [ ] **配置备份**: 配置文件备份已配置
- [ ] **备份测试**: 备份恢复测试通过
- [ ] **异地备份**: 异地备份已配置（如需要）

### 🔄 恢复测试

- [ ] **数据恢复**: 数据库恢复测试通过
- [ ] **应用恢复**: 应用恢复测试通过
- [ ] **完整恢复**: 完整系统恢复测试通过
- [ ] **恢复时间**: 恢复时间符合RTO要求
- [ ] **恢复文档**: 恢复操作文档已准备

## 📚 文档准备

### 📖 技术文档

- [ ] **部署文档**: 部署文档已更新
- [ ] **配置文档**: 配置说明文档已准备
- [ ] **API文档**: API接口文档已更新
- [ ] **故障排除**: 故障排除指南已准备
- [ ] **运维手册**: 运维操作手册已准备

### 👥 用户文档

- [ ] **用户手册**: 用户操作手册已准备
- [ ] **管理员指南**: 管理员使用指南已准备
- [ ] **培训材料**: 用户培训材料已准备
- [ ] **FAQ文档**: 常见问题文档已准备

## 🎯 上线准备

### 📅 上线计划

- [ ] **上线时间**: 上线时间已确定并通知
- [ ] **回滚计划**: 回滚方案已准备
- [ ] **人员安排**: 上线人员已安排
- [ ] **应急预案**: 应急处理预案已准备
- [ ] **用户通知**: 用户上线通知已发送

### ✅ 最终检查

- [ ] **功能验收**: 所有功能验收通过
- [ ] **性能验收**: 性能指标达标
- [ ] **安全验收**: 安全测试通过
- [ ] **文档完整**: 所有文档已准备完毕
- [ ] **团队就绪**: 运维团队已就绪

## 📋 上线后检查

### 🔍 即时检查（上线后1小时内）

- [ ] **服务状态**: 所有服务运行正常
- [ ] **用户访问**: 用户可正常访问系统
- [ ] **核心功能**: 核心功能正常工作
- [ ] **性能指标**: 性能指标正常
- [ ] **错误日志**: 无严重错误日志

### 📊 持续监控（上线后24小时内）

- [ ] **系统稳定性**: 系统运行稳定
- [ ] **用户反馈**: 收集用户反馈
- [ ] **性能监控**: 持续性能监控
- [ ] **错误监控**: 错误率在正常范围
- [ ] **资源使用**: 资源使用率正常

### 📈 长期监控（上线后1周内）

- [ ] **业务指标**: 业务指标正常
- [ ] **用户满意度**: 用户满意度调查
- [ ] **系统优化**: 根据监控数据优化
- [ ] **文档更新**: 根据实际情况更新文档
- [ ] **经验总结**: 部署经验总结

## 🚨 应急联系

### 👥 关键人员

| 角色 | 姓名 | 电话 | 邮箱 | 备注 |
|------|------|------|------|------|
| 项目经理 | [姓名] | [电话] | [邮箱] | 总体协调 |
| 技术负责人 | [姓名] | [电话] | [邮箱] | 技术决策 |
| 运维工程师 | [姓名] | [电话] | [邮箱] | 系统运维 |
| 数据库管理员 | [姓名] | [电话] | [邮箱] | 数据库管理 |
| 网络工程师 | [姓名] | [电话] | [邮箱] | 网络问题 |

### 📞 应急流程

1. **发现问题** → 立即评估影响范围
2. **通知相关人员** → 按照联系清单通知
3. **启动应急预案** → 执行预定的应急措施
4. **问题解决** → 修复问题并验证
5. **事后总结** → 分析原因并改进

## ✅ 签字确认

### 📝 检查确认

- [ ] **技术负责人**: _________________ 日期: _________
- [ ] **运维工程师**: _________________ 日期: _________
- [ ] **项目经理**: _________________ 日期: _________
- [ ] **质量保证**: _________________ 日期: _________

### 🎯 上线批准

- [ ] **部门经理**: _________________ 日期: _________
- [ ] **技术总监**: _________________ 日期: _________

---

**文档版本**: v2.0.0  
**最后更新**: 2024-01-31  
**维护者**: 协和医院IT部门

> ⚠️ **重要提醒**: 请确保所有检查项都已完成并确认，未完成的项目可能导致生产环境问题。